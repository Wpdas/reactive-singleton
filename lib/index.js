Object.defineProperty(exports,"__esModule",{value:!0});var t,e,n=require("react"),s=(t=n)&&"object"==typeof t&&"default"in t?t.default:t,r=function(){return(r=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},u={},o=function(t){return u[t]},i={},a=function(t){return i[t]},c={status:"ready"},f=n.createContext(c),l=function(){function t(){this.observers=[]}return t.prototype.subscribe=function(t){this.observers.push(t)},t.prototype.unsubbscribe=function(t){this.observers=this.observers.filter((function(e){return e!==t}))},t.prototype.notify=function(t){this.observers.forEach((function(e){return e(t)}))},t}(),b=function(){function t(){var t,e,n;this.status="ready",this.key="_"+Math.random().toString(36).substr(2,9),t=this.key,e=new l,u=r(r({},u),((n={})[t]=e,n))}return t.prototype.setClass=function(t){var e=t;this.singletonClass=e},t.prototype.getProps=function(){return{singleton:this.singletonClass,status:this.status,key:this.key}},t}();function v(t){n.useContext(f);var e=function(t){var e=t.name,n=a(e);if(!n)throw new Error(e+" singleton was not correctly initialized or doesn't exist! Please, create your Singleton using createSingleton()'s setValue.");var s=n.getProps(),r=s.singleton,u=s.status,i=s.key;return{singleton:r,status:u,observable:o(i)}}(t);return{status:e.status,statusObservable:e.observable}}function p(t){return v(t).status}function y(t){p(t)}exports.SingletonProvider=function(t){var r=t.children,l=n.useState(c.status),b=l[0],v=l[1];return n.useEffect((function(){Object.keys(u).forEach((function(t){o(t).subscribe((function(t){e===t&&(e="next_status"),v(e=t)}))}))}),[]),n.useEffect((function(){Object.keys(i).forEach((function(t){var e=a(t);"ready"!==e.status&&v(e.status)}))}),[]),s.createElement(f.Provider,{value:{status:b}},r)},exports.createSingleton=function(){var t=new b;return{watch:function(e){var n=o(t.key);t.status="in_progress",n.notify(t.status),e((function(){setTimeout((function(){t.status="ready",n.notify(t.status)}),0)}))},setClass:function(e){var n,s,u;t.setClass(e),n=e.name,s=t,i=r(r({},i),((u={})[n]=s,u))}}},exports.useReRenderOnUpdate=y,exports.useSingletonStatus=p,exports.useWasDataUpdated=function(t,e){void 0===e&&(e=500);var s=function(t){return v(t).statusObservable}(t),r=n.useState(!1),u=r[0],o=r[1],i=function(t,e){var s=n.useState(t),r=s[0],u=s[1];return n.useEffect((function(){var n=setTimeout((function(){u(t)}),e);return function(){clearTimeout(n)}}),[t,e]),r}(u,e);return n.useEffect((function(){var t=function(e){"ready"===e&&(o(!0),s.unsubbscribe(t))};return s.subscribe(t),function(){s.unsubbscribe(t)}}),[]),i},exports.withSingleton=function(t,e){return function(n){return y(e),s.createElement(t,r({},n))}};
